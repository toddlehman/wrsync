# wrsync (wrapper for rsync)

This program improves the interface of the standard `rsync` tool by invoking it
as a subprocess and modifying its output in the following ways:

1.  The multi-column information generated by `rsync`'s `--itemize-changes`
option is boiled down to four cases:

       `·`  Trivial timestamp change (directories only)  
       `◦`  Metadata update (any type)  
       `•`  Content transfer or creation (file, directory, link, etc.)  
       `⨉`  Deletion (any type)

2.  When synchronizing, an itemization pass is always performed to calculate
    the total size of the payload to be transferred.  This total is then used
    during the synchronization pass to give live (up-to-the-second) progress
    updates of not only the current file but the entire payload.  For example,
    the following line shows that 18% of the 271st of 327 items has been thus
    far transferred, with a total completion of 92.63% of 38.24 GB, and an
    overall rate of 51.08 MB/s, with an estimated time of completion in
    approximately 6 minutes, at approximately 2:45pm:

       `18% of 271 of 327   92.63% of 38.24 GB   51.08 MB/s   2:45pm (5m 49s)`

3.  After synchronization is complete, a short summary is given.  For example,
    the following line (split into two lines here) shows that 38.24 GB of a
    possible 424.8 GB were transferred or altered, consisting of 327 of a
    possible 3,697 items, at an overall rate of 51.23 MB/s, in approximately
    12.5 minutes, plus a summary indicating that 253 items were transferred,
    12 items were updated, and 6 items were deleted:

       `38.24 GB (of 424.8 GB) in 327 (of 3,697) items in 12m 26s (51.23 MB/s):`  
       `  · 5  ◦ 12  • 248  ⨉ 6`
        
This program is mostly a drop-in replacement for `rsync`, but has the following
notable differences:

   `--local-rsync-path=PATH`  
         Overrides the default path of the rsync program on the local system.
         This is offered mainly for testing and should rarely be necessary.

   `--remote-rsync-path=PATH`  
         Overrides the default path of the rsync program on the remote system.
         This is offered mainly for testing and should rarely be necessary.

   `--debug`  
         Enables voluminous output showing the contents of the rsync output
         as well as other information.

   `--compare-only`  
         Performs a single-pass, silent comparison of the source and
         destination, setting the exit value of this program as follows:  
             0  Source and destination are identical.  
             1  Source and destination are not identical.  
         Note that "identical" here does not necessarily mean that the source
         and destination are truly identical; it merely means that rsync
         considers them to be identical after applying filter rules
         (inclusions, exclusions, uid/gid mapping, etc.).  In short,
         "identical" here means that if rsync were invoked to perform a
         synchronization, it would have nothing to do.

   `--itemize-changes`  
         Enables itemization mode.  Causes filenames (and directories, etc.)
         to be listed as they are transferred or updated, one per line, as
         discussed above in point number 3.  Note:  This mode is enabled by
         default, in contrast with rsync, where it is disabled by default.

   `--no-itemize-changes`  
         Disables itemization mode.  With this option, output of this program
         is minimal.

   `--progress`  
         Enables progress mode.  Causes live updates to be shown (using lines
         ending in \r) during file transfer, as discussed above in point
         number 2.  Note:  This mode is enabled by default, in contrast with
         rsync, where it is disabled by default.

   `--no-progress`  
         Disables progress mode.  With this option, no way of seeing the
         estimated completion time or amount of work to be performed is
         available to the user until the program completes.  Note that the
         post-transfer summary described in point number 3 above is shown
         regardless of the --progress option, unless --no-summary is
         specified.

   `--summary`  
         Enables the output of a summary line upon completion of work.  This
         is enabled by default.

   `--no-summary`  
         Disables output of a summary line.

   `--dry-run`, `-n`  
         Perform only a single pass to determine the workload and prints a
         summary as described in point number 3 above.  If no changes are
         necessary between the source and destination, then "No changes" is
         the only output.  (Warning:  In scripts, do not rely on the textual
         output of the words "No changes," as the output may change.  Instead,
         use the --compare-only option and examine the exit value.)

Note:  `rsync` version 3.1.3 or higher is assumed.

Author:  Todd Lehman, December 2019
